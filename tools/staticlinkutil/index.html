<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="PlasmaDev">
    <link rel="canonical" href="https://plasmaengine.github.io/PlasmaDocs/tools/staticlinkutil/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>StaticLinkUtil - PlasmaDocs</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "StaticLinkUtil", url: "#_top", children: [
              {title: "Mitigation", url: "#mitigation" },
              {title: "Usage", url: "#usage" },
              {title: "See Also", url: "#see-also" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script>
      <script src="../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../texconv/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../texconv/" class="btn btn-xs btn-link">
        plTexConv
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../shadercompiler/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../shadercompiler/" class="btn btn-xs btn-link">
        ShaderCompiler
      </a>
    </div>
    
  </div>

    

    <h1 id="staticlinkutil">StaticLinkUtil</h1>
<p>When <strong>statically linking</strong> libraries into an application the linker will only pull in all the functions and variables that are inside
translation units (CPP files) that somehow get referenced.</p>
<p>In Plasma a lot of stuff happens automatically (e.g. types register themselves etc.), which is accomplished through global variables
that execute code in their constructor during the application's startup phase. This only works when those global variables are actually
put into the application by the linker. If the linker does not do that, functionality will not work as intended.</p>
<h2 id="mitigation">Mitigation</h2>
<p>Contrary to common believe, the linker is not allowed to optimize away global variables. The only reason for not including a global
variable into the final binary, is when the entire translation unit where a variable is defined in, is never referenced and thus never
even looked at by the linker.</p>
<p>To fix this, the StaticLinkUtil inserts macros into each and every file which reference each other. Afterwards every file in a library will
reference every other file in that same library and thus once a library is used in any way in some program, the entire library
will be pulled in and will then work as intended.</p>
<p>These references are accomplished through empty functions that are called in one central location (where <code>PLASMA_STATICLINK_LIBRARY</code> is defined),
though the code actually never really calls those functions, but it is enough to force the linker to look at all the other files.</p>
<h2 id="usage">Usage</h2>
<p>Call this tool with the path to the root folder of some library as the sole command line argument:</p>
<pre><code class="language-cmd">StaticLinkUtil.exe &quot;C:\PlasmaEngine\Code\Engine\Foundation&quot;
</code></pre>
<p>This will iterate over all files below that folder and insert the proper macros.
Also make sure that exactly one file in each library contains the text <code>PLASMA_STATICLINK_LIBRARY();</code></p>
<p>The parameters and function bodies will be generated automatically and later updated, you do not need to provide more.</p>
<p>You only need to run this tool, if you intend to link statically, which is only needed on some platforms. Even then, most new code will work even without always keeping the static link macros up to date, as the issues that it fixes are not too common. If, however, you notice that some types are missing (such as new components) that were just added, you should rerun this tool on the affected libraries.</p>
<h2 id="see-also">See Also</h2>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../texconv/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../texconv/" class="btn btn-xs btn-link">
        plTexConv
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../shadercompiler/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../shadercompiler/" class="btn btn-xs btn-link">
        ShaderCompiler
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/noraj/mkdocs-windmill-dark">Windmill Dark</a> theme by Alexandre ZANNI (noraj).</p>
</footer>

</body>
</html>