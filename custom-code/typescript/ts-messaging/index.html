<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="PlasmaDev">
    <link rel="canonical" href="https://plasmaengine.github.io/PlasmaDocs/custom-code/typescript/ts-messaging/">
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Messaging in TypeScript Code - PlasmaDocs</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Messaging in TypeScript Code", url: "#_top", children: [
              {title: "Sending Messages", url: "#sending-messages" },
              {title: "Handling Messages", url: "#handling-messages" },
              {title: "Declaring a Message in TypeScript", url: "#declaring-a-message-in-typescript" },
              {title: "See Also", url: "#see-also" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../typescript-overview/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../typescript-overview/" class="btn btn-xs btn-link">
        Custom Code with TypeScript
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../ts-component/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../ts-component/" class="btn btn-xs btn-link">
        TypeScript Component
      </a>
    </div>
    
  </div>

    

    <h1 id="messaging-in-typescript-code">Messaging in TypeScript Code</h1>
<p>TypeScript components can both send and receive messages. The way messages can be sent, posted and received, and how messages are routed is identical to the behavior on the C++ side. Please read the chapter about <a href="../../../runtime/world/world-messaging/">messaging</a> to familiarize yourself with the general concepts.</p>
<p>The main difference in TypeScript is, that messages that have been declared in C++ can be sent and received in TypeScript, but messages that have been declared in TypeScript can only be sent and received by TypeScript code.</p>
<h2 id="sending-messages">Sending Messages</h2>
<p>You can either send a message directly to a specific component (through <code>pl.Component</code>) or to a game object hierarchy (through <code>pl.GameObject</code>). Contrary to the C++ API, there are no functions on <code>pl.World</code> to send messages.</p>
<p>The <code>SendMessage()</code> functions on <code>pl.Component</code> and <code>pl.GameObject</code> take an additional boolean parameter <code>expectResultData</code>. If this is set to true, that means that the sender of the message expects the receiver(s) to write back result data into the sent message, and intends to read those results afterwards. If it is set to false, the message sender does either not expect result data in the message, or doesn't intend to read it. This is an optimization, if you need any result data, set the parameter to true, which means additional work is necessary to synchronize the message back to the caller. Otherwise keep this set to the default value (false).</p>
<h3 id="sending-event-messages">Sending Event Messages</h3>
<p>TypeScript components can raise <em>event messages</em> on themselves through <code>pl.TypescriptComponent.BroadcastEvent()</code>.</p>
<blockquote>
<p><strong>Note:</strong></p>
<p>At the moment TypeScript components can't raise event messages on other components or game objects.</p>
</blockquote>
<h2 id="handling-messages">Handling Messages</h2>
<p>To handle messages of a specific type, a component needs a function that takes that message type as its only parameter, and it must register that function as a message handler:</p>
<pre><code class="language-typescript">static RegisterMessageHandlers()
{
    pl.TypescriptComponent.RegisterMessageHandler(pl.MsgSetColor, &quot;OnMsgSetColor&quot;);
}

OnMsgSetColor(msg: pl.MsgSetColor): void
{
    pl.Log.Info(&quot;MsgSetColor: &quot; + msg.Color.r + &quot;, &quot; + msg.Color.g + &quot;, &quot; + msg.Color.b + &quot;, &quot; + msg.Color.a);
}
</code></pre>
<p>The static function <code>RegisterMessageHandlers()</code> is the only place where your code may call <code>pl.TypescriptComponent.RegisterMessageHandler()</code>. It is an error to call this from anywhere else.</p>
<h2 id="declaring-a-message-in-typescript">Declaring a Message in TypeScript</h2>
<p>You declare a custom message in TypeScript by extending <code>pl.Message</code>:</p>
<pre><code class="language-typescript">export class MsgShowText extends pl.Message {

    PLASMA_DECLARE_MESSAGE_TYPE;

    text: string;
}
</code></pre>
<blockquote>
<p><strong>Important:</strong></p>
<p>It is vital to insert <code>PLASMA_DECLARE_MESSAGE_TYPE;</code> into the body of the message to make it work.</p>
</blockquote>
<p>If you need to send a message from one component and handle it in other component types, you should put the message declaration into a separate <code>.ts</code> file and <code>import</code> that file from both component files. See <a href="../ts-api/#importing-files-require">Importing Files (<code>require</code>)</a> for details.</p>
<h3 id="declaring-event-messages">Declaring Event Messages</h3>
<blockquote>
<p><strong>Note:</strong></p>
<p>At the moment it is <strong>not supported to declare event messages</strong>.</p>
</blockquote>
<h2 id="see-also">See Also</h2>
<ul>
<li><a href="../ts-api/">TypeScript API</a></li>
<li><a href="../custom-ts-components/">Custom Components with TypeScript</a></li>
</ul>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../typescript-overview/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../typescript-overview/" class="btn btn-xs btn-link">
        Custom Code with TypeScript
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../ts-component/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../ts-component/" class="btn btn-xs btn-link">
        TypeScript Component
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/noraj/mkdocs-windmill-dark">Windmill Dark</a> theme by Alexandre ZANNI (noraj).</p>
</footer>

</body>
</html>