<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="PlasmaDev">
    <link rel="canonical" href="https://plasmaengine.github.io/PlasmaDocs/runtime/world/object-lifetime/">
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Object Lifetime - PlasmaDocs</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Object Lifetime", url: "#_top", children: [
              {title: "Referencing Objects", url: "#referencing-objects" },
              {title: "Deleting Game Objects", url: "#deleting-game-objects" },
              {title: "Deleting Components", url: "#deleting-components" },
              {title: "See Also", url: "#see-also" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script>
      <script src="../../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../spatial-system/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../spatial-system/" class="btn btn-xs btn-link">
        Spatial System
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../game-objects/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../game-objects/" class="btn btn-xs btn-link">
        Game Objects
      </a>
    </div>
    
  </div>

    

    <h1 id="object-lifetime">Object Lifetime</h1>
<p>The lifetime of <a href="../game-objects/">game objects</a> and <a href="../components/">components</a> is tightly controlled by the <a href="../worlds/">world</a> that they belong to. Neither are objects reference counted, nor garbage collected. You have full control over the destruction of objects, but by default 'deleted' objects are not destroyed before the end of the frame, to make writing robust code easy.</p>
<p>The lifetime of objects is directly linked to the object hierarchy. If a game object gets deleted, that also deletes all child nodes and all attached components.</p>
<h2 id="referencing-objects">Referencing Objects</h2>
<p>In C++ you can of course always hold pointers to anything. Within a single frame, it is fine to reference game objects and components by pointers. However, once the next frame starts, you have to assume that those pointers are invalid. Not only can objects be deleted, but even live objects can be moved around in memory. This 'compacting' is an optimization and can happen to any object between frames.</p>
<p>Therefore, instead of keeping pointers to objects, you should always use <em>handles</em>. Specifically <code>plGameObjectHandle</code> for <code>plGameObject</code> references, and <code>plComponentHandle</code> for <code>plComponent</code> (and derived) types.</p>
<p>Handles act like <a href="https://en.wikipedia.org/wiki/Weak_reference">weak pointers</a>. Once you have a handle to an object, you can keep it around forever. When you need to access the actual object, you call <code>plWorld::TryGetObject()</code> or <code>plWorld::TryGetComponent()</code>. If the object is still alive at that time, you get back a pointer. That pointer is guaranteed to stay valid until the end of the frame, so you don't need to call the <code>TryGet...</code> function again.</p>
<p>As a rule of thumb, you should <em>never</em> have <code>plGameObject*</code> or <code>plComponent*</code> types as class members. Pointers to these types should be limited to local function variables.</p>
<h2 id="deleting-game-objects">Deleting Game Objects</h2>
<p>To delete a game object, call <code>plWorld::DeleteObjectDelayed()</code>. This will put the object into a deletion queue, and will remove the object at the end of the frame. This guarantees that all code that tries to access the object within this frame will work correctly.</p>
<p>You can also call <code>plWorld::DeleteObjectNow()</code>. This will indeed delete the object right at that instant. The only situation where it is ok to call this, is in tools where you modify a world in a single threaded way and you know that no other code can ever access objects. Here, having an object not destroyed immediately may be undesirable.</p>
<h2 id="deleting-components">Deleting Components</h2>
<p>To delete a component, get its <a href="../component-managers/">component manager</a> and call <code>DeleteComponent()</code> on it. The component won't be deallocated right away, that is deferred till the end of the frame. However, it will be <em>deactivated</em> and <em>deinitialized</em> immediately. Therefore, if other code tries to access such a component, it will get valid memory, but it may see a deinitialized component. Such a situation can be detected by calling <code>plComponent::IsActiveAndInitialized()</code> on the target. If you delete individual components during a frame (and not entire objects), code that accesses those components should be prepared to deal with deinitialized components.</p>
<h2 id="see-also">See Also</h2>
<ul>
<li><a href="../game-objects/">Game Objects</a></li>
<li><a href="../components/">Components</a></li>
</ul>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../spatial-system/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../spatial-system/" class="btn btn-xs btn-link">
        Spatial System
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../game-objects/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../game-objects/" class="btn btn-xs btn-link">
        Game Objects
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/noraj/mkdocs-windmill-dark">Windmill Dark</a> theme by Alexandre ZANNI (noraj).</p>
</footer>

</body>
</html>